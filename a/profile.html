<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªì s∆° kh√°ch h√†ng</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      color: #333;
    }

    /* HEADER */
    header {
      background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
      color: white;
      padding: 16px 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .header-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    nav {
      display: flex;
      gap: 16px;
    }

    nav a {
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
      font-weight: 500;
      transition: background 0.2s;
    }

    nav a:hover {
      background: rgba(255,255,255,0.3);
    }

    /* MAIN */
    main {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 24px;
    }

    /* PROFILE CARD */
    .profile-container {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .profile-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 40px 24px;
      text-align: center;
      color: white;
    }

    .profile-avatar {
      width: 120px;
      height: 120px;
      background: white;
      border-radius: 50%;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }

    .profile-name {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .profile-email {
      font-size: 16px;
      opacity: 0.9;
    }

    /* FORM */
    .profile-form {
      padding: 32px;
    }

    .form-section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e5e7eb;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-weight: 600;
      color: #374151;
      font-size: 14px;
    }

    input {
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 15px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #06b6d4);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .btn-danger {
      background: #fee2e2;
      color: #dc2626;
    }

    .btn-danger:hover {
      background: #fecaca;
    }

    /* SUCCESS MESSAGE */
    .message {
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
      font-weight: 600;
    }

    .message.success {
      background: #d1fae5;
      color: #065f46;
      display: block;
    }

    .message.error {
      background: #fee2e2;
      color: #991b1b;
      display: block;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .form-actions {
        flex-direction: column;
      }

      .profile-header {
        padding: 30px 20px;
      }

      .profile-avatar {
        width: 100px;
        height: 100px;
        font-size: 50px;
      }

      .profile-name {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-container">
      <h1>üë§ H·ªì s∆° c√° nh√¢n</h1>
      <nav>
        <a href="../index.html">‚Üê Trang ch·ªß</a>
        <a href="cart.html">üõí Gi·ªè h√†ng</a>
        <a href="orders.html">üì¶ ƒê∆°n h√†ng</a>
        <a href="#" onclick="logout()" style="background: rgba(239, 68, 68, 0.3)">üö™ ƒêƒÉng xu·∫•t</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="profile-container">
      <div class="profile-header">
        <div class="profile-avatar">üë§</div>
        <div class="profile-name" id="displayName">...</div>
        <div class="profile-email" id="displayEmail">...</div>
      </div>

      <form id="profileForm" class="profile-form">
        <div id="message" class="message"></div>

        <div class="form-section">
          <h2 class="section-title">üìã Th√¥ng tin c∆° b·∫£n</h2>
          <div class="form-grid">
            <div class="form-group full-width">
              <label>T√™n c√¥ng ty / T·ªï ch·ª©c</label>
              <input type="text" id="customerName" placeholder="VD: C√¥ng ty ABC">
            </div>
            <div class="form-group">
              <label>H·ªç</label>
              <input type="text" id="contactLastName" placeholder="Nguy·ªÖn" required>
            </div>
            <div class="form-group">
              <label>T√™n</label>
              <input type="text" id="contactFirstName" placeholder="VƒÉn A" required>
            </div>
            <div class="form-group">
              <label>S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="tel" id="phone" placeholder="0912345678" required>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-title">üìç ƒê·ªãa ch·ªâ</h2>
          <div class="form-grid">
            <div class="form-group full-width">
              <label>ƒê·ªãa ch·ªâ</label>
              <input type="text" id="addressLine1" placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng" required>
            </div>
            <div class="form-group">
              <label>Th√†nh ph·ªë / T·ªânh</label>
              <input type="text" id="city" placeholder="H√† N·ªôi" required>
            </div>
            <div class="form-group">
              <label>Qu·ªëc gia</label>
              <input type="text" id="country" placeholder="Vi·ªát Nam" required>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            üíæ L∆∞u thay ƒë·ªïi
          </button>
          <button type="button" class="btn btn-secondary" onclick="loadProfile()">
            üîÑ L√†m m·ªõi
          </button>
        </div>
      </form>
    </div>
  </main>

  <script src="../assets/js/api.js"></script>
  <script>
    const user = JSON.parse(localStorage.getItem('user'));
    const token = localStorage.getItem('token');

    if (!token || !user) {
      alert('‚ö†Ô∏è Vui l√≤ng ƒëƒÉng nh·∫≠p');
      window.location.href = 'login.html';
    }

    // Display user info in header
    document.getElementById('displayName').textContent = user.name || 'Kh√°ch h√†ng';
    document.getElementById('displayEmail').textContent = user.email || '';

    async function loadProfile() {
      try {
        const data = await apiRequest(`/customers/${user.id}`, 'GET', null, true);
        
        document.getElementById('customerName').value = data.customerName || '';
        document.getElementById('contactLastName').value = data.contactLastName || '';
        document.getElementById('contactFirstName').value = data.contactFirstName || '';
        document.getElementById('phone').value = data.phone || '';
        document.getElementById('addressLine1').value = data.addressLine1 || '';
        document.getElementById('city').value = data.city || '';
        document.getElementById('country').value = data.country || '';
        
        showMessage('‚úÖ ƒê√£ t·∫£i th√¥ng tin th√†nh c√¥ng', 'success');
      } catch (err) {
        showMessage('‚ùå L·ªói t·∫£i th√¥ng tin: ' + err.message, 'error');
      }
    }

    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        customerName: document.getElementById('customerName').value,
        contactLastName: document.getElementById('contactLastName').value,
        contactFirstName: document.getElementById('contactFirstName').value,
        phone: document.getElementById('phone').value,
        addressLine1: document.getElementById('addressLine1').value,
        addressLine2: '',
        city: document.getElementById('city').value,
        state: '',
        postalCode: '',
        country: document.getElementById('country').value,
        salesRepEmployeeNumber: null,
        creditLimit: null
      };

      try {
        await apiRequest(`/customers/${user.id}`, 'PUT', data, true);
        showMessage('‚úÖ C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!', 'success');
        
        // Update localStorage
        user.name = `${data.contactFirstName} ${data.contactLastName}`;
        localStorage.setItem('user', JSON.stringify(user));
        document.getElementById('displayName').textContent = user.name;
      } catch (err) {
        showMessage('‚ùå L·ªói c·∫≠p nh·∫≠t: ' + err.message, 'error');
      }
    });

    function showMessage(text, type) {
      const msgEl = document.getElementById('message');
      msgEl.textContent = text;
      msgEl.className = `message ${type}`;
      
      setTimeout(() => {
        msgEl.className = 'message';
      }, 5000);
    }

    function logout() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        localStorage.removeItem('cart');
        alert('‚úÖ ƒê√£ ƒëƒÉng xu·∫•t!');
        window.location.href = 'login.html';
      }
    }

    loadProfile();
  </script>
</body>
</html>