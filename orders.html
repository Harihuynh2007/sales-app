<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω ƒê∆°n H√†ng</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        .header h1 { font-size: 24px; }
        .nav { display: flex; gap: 10px; margin-top: 10px; }
        .nav a { color: white; text-decoration: none; padding: 8px 16px; background: #34495e; border-radius: 4px; }
        .nav a:hover { background: #1abc9c; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 5px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-group textarea { resize: vertical; min-height: 60px; }
        .full-width { grid-column: 1 / -1; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #2ecc71; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn:hover { opacity: 0.9; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; }
        table th, table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        table th { background: #34495e; color: white; font-weight: 600; }
        table tr:hover { background: #f8f9fa; }
        .actions { display: flex; gap: 5px; }
        .actions button { padding: 6px 12px; font-size: 12px; }
        .alert { padding: 12px; border-radius: 4px; margin-bottom: 15px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .status-shipped { background: #d4edda; color: #155724; }
        .status-process { background: #fff3cd; color: #856404; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõçÔ∏è H·ªá Th·ªëng Qu·∫£n L√Ω B√°n H√†ng</h1>
            <div class="nav">
                <a href="products.html">S·∫£n Ph·∫©m</a>
                <a href="customers.html">Kh√°ch H√†ng</a>
                <a href="orders.html">ƒê∆°n H√†ng</a>
            </div>
        </div>

        <div class="card">
            <h2>üì¶ Qu·∫£n L√Ω ƒê∆°n H√†ng</h2>
            <div id="alertBox"></div>
            
            <form id="orderForm">
                <input type="hidden" id="orderNumber">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Kh√°ch H√†ng *</label>
                        <select id="customerNumber" required>
                            <option value="">Ch·ªçn kh√°ch h√†ng</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng Th√°i *</label>
                        <select id="status" required>
                            <option value="In Process">ƒêang x·ª≠ l√Ω</option>
                            <option value="Shipped">ƒê√£ giao</option>
                            <option value="Cancelled">ƒê√£ h·ªßy</option>
                            <option value="On Hold">T·∫°m gi·ªØ</option>
                            <option value="Resolved">ƒê√£ gi·∫£i quy·∫øt</option>
                            <option value="Disputed">Tranh ch·∫•p</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ng√†y ƒê·∫∑t H√†ng *</label>
                        <input type="date" id="orderDate" required>
                    </div>
                    <div class="form-group">
                        <label>Ng√†y Y√™u C·∫ßu *</label>
                        <input type="date" id="requiredDate" required>
                    </div>
                    <div class="form-group">
                        <label>Ng√†y Giao H√†ng</label>
                        <input type="date" id="shippedDate">
                    </div>
                    <div class="form-group full-width">
                        <label>Ghi Ch√∫</label>
                        <textarea id="comments"></textarea>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">üíæ L∆∞u</button>
                    <button type="button" class="btn btn-warning" onclick="resetForm()">üîÑ Reset</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h3>üìã Danh S√°ch ƒê∆°n H√†ng</h3>
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>M√£ ƒêH</th>
                        <th>Kh√°ch H√†ng</th>
                        <th>Ng√†y ƒê·∫∑t</th>
                        <th>Ng√†y Y√™u C·∫ßu</th>
                        <th>Ng√†y Giao</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>Thao T√°c</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let isEditMode = false;

        async function loadCustomers() {
            const res = await fetch(`${API_URL}/customers`);
            const customers = await res.json();
            const select = document.getElementById('customerNumber');
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.customerNumber;
                option.textContent = customer.customerName;
                select.appendChild(option);
            });
        }

        async function loadOrders() {
            const res = await fetch(`${API_URL}/orders`);
            const orders = await res.json();
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';
            orders.forEach(order => {
                const statusClass = order.status === 'Shipped' ? 'status-shipped' : 
                                  order.status === 'In Process' ? 'status-process' : 'status-cancelled';
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${order.orderNumber}</td>
                    <td>${order.customerName}</td>
                    <td>${new Date(order.orderDate).toLocaleDateString('vi-VN')}</td>
                    <td>${new Date(order.requiredDate).toLocaleDateString('vi-VN')}</td>
                    <td>${order.shippedDate ? new Date(order.shippedDate).toLocaleDateString('vi-VN') : 'Ch∆∞a giao'}</td>
                    <td><span class="status-badge ${statusClass}">${order.status}</span></td>
                    <td class="actions">
                        <button class="btn btn-primary" onclick="editOrder(${order.orderNumber})">‚úèÔ∏è S·ª≠a</button>
                        <button class="btn btn-danger" onclick="deleteOrder(${order.orderNumber})">üóëÔ∏è X√≥a</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                customerNumber: parseInt(document.getElementById('customerNumber').value),
                orderDate: document.getElementById('orderDate').value,
                requiredDate: document.getElementById('requiredDate').value,
                shippedDate: document.getElementById('shippedDate').value || null,
                status: document.getElementById('status').value,
                comments: document.getElementById('comments').value || null
            };

            try {
                let res;
                if (isEditMode) {
                    const id = document.getElementById('orderNumber').value;
                    res = await fetch(`${API_URL}/orders/${id}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data)
                    });
                } else {
                    res = await fetch(`${API_URL}/orders`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data)
                    });
                }
                const result = await res.json();
                showAlert(result.message, 'success');
                resetForm();
                loadOrders();
            } catch (error) {
                showAlert('C√≥ l·ªói x·∫£y ra: ' + error.message, 'error');
            }
        });

        async function editOrder(id) {
            const res = await fetch(`${API_URL}/orders/${id}`);
            const order = await res.json();
            document.getElementById('orderNumber').value = order.orderNumber;
            document.getElementById('customerNumber').value = order.customerNumber;
            document.getElementById('orderDate').value = order.orderDate.split('T')[0];
            document.getElementById('requiredDate').value = order.requiredDate.split('T')[0];
            document.getElementById('shippedDate').value = order.shippedDate ? order.shippedDate.split('T')[0] : '';
            document.getElementById('status').value = order.status;
            document.getElementById('comments').value = order.comments || '';
            isEditMode = true;
            window.scrollTo(0, 0);
        }

        async function deleteOrder(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n h√†ng n√†y?')) return;
            try {
                const res = await fetch(`${API_URL}/orders/${id}`, { method: 'DELETE' });
                const result = await res.json();
                showAlert(result.message, 'success');
                loadOrders();
            } catch (error) {
                showAlert('Kh√¥ng th·ªÉ x√≥a ƒë∆°n h√†ng: ' + error.message, 'error');
            }
        }

        function resetForm() {
            document.getElementById('orderForm').reset();
            document.getElementById('orderNumber').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('orderDate').value = today;
            document.getElementById('requiredDate').value = today;
            isEditMode = false;
        }

        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => alertBox.innerHTML = '', 3000);
        }

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('orderDate').value = today;
        document.getElementById('requiredDate').value = today;

        loadCustomers();
        loadOrders();
    </script>
</body>
</html>